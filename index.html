<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Ordering</title>
    
    <!-- CRITICAL: Telegram Web App SDK must be loaded first -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--tg-theme-hint-color, #ccc);
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .product-card {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .product-card h3 {
            margin-bottom: 8px;
            color: var(--tg-theme-text-color);
        }
        
        .price {
            color: var(--tg-theme-link-color, #2481cc);
            font-weight: bold;
            font-size: 20px;
            margin: 10px 0;
        }
        
        .add-btn {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        
        .add-btn:active {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üçï My Food Store</h1>
        <p id="welcome">Welcome!</p>
    </div>
    
    <div id="products" class="product-grid">
        <!-- Products will be dynamically added here -->
    </div>

    <script>
        // Initialize Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // Personalize greeting with user's name
        if (tg.initDataUnsafe.user) {
            document.getElementById('welcome').textContent = 
                'Welcome, ' + tg.initDataUnsafe.user.first_name + '!';
        }
        
        // Sample product catalog
        const products = [
            { id: 1, name: 'Margherita Pizza', description: 'Classic tomato and mozzarella', price: 12.00, emoji: 'üçï' },
            { id: 2, name: 'Pepperoni Pizza', description: 'Spicy pepperoni with cheese', price: 14.00, emoji: 'üçï' },
            { id: 3, name: 'Classic Burger', description: 'Beef patty with fresh vegetables', price: 10.00, emoji: 'üçî' },
            { id: 4, name: 'Cheese Burger', description: 'Double cheese and beef', price: 11.00, emoji: 'üçî' }
        ];
        
        // Shopping cart (in-memory storage)
        let cart = [];
        
        // Display products on page
        const productsDiv = document.getElementById('products');
        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <h3>${product.emoji} ${product.name}</h3>
                <p>${product.description}</p>
                <p class="price">$${product.price.toFixed(2)}</p>
                <button class="add-btn" onclick="addToCart(${product.id})">
                    Add to Cart
                </button>
            `;
            productsDiv.appendChild(card);
        });
        
        // Add item to cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            
            // Check if item already in cart
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            
            // Haptic feedback for better UX
            tg.HapticFeedback.impactOccurred('medium');
            
            // Update main button
            updateMainButton();
            
            // Show confirmation
            tg.showAlert('Added to cart!');
        }
        
        // Update Telegram's main button
        function updateMainButton() {
            if (cart.length > 0) {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const itemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
                
                tg.MainButton.setText(`View Cart (${itemCount} items - $${total.toFixed(2)})`);
                tg.MainButton.show();
                tg.MainButton.onClick(viewCart);
            } else {
                tg.MainButton.hide();
            }
        }
        
        // Send order data to bot
        function viewCart() {
            const orderData = {
                items: cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price
                })),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                user: tg.initDataUnsafe.user
            };
            
            // Send data back to Telegram bot
            tg.sendData(JSON.stringify(orderData));
        }
    </script>
</body>
</html>
